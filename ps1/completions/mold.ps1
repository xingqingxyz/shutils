Register-ArgumentCompleter -Native -CommandName mold, ld.mold -ScriptBlock {
  param ([string]$wordToComplete, [System.Management.Automation.Language.CommandAst]$commandAst, [int]$cursorPosition)
  $cursorPosition -= $wordToComplete.Length
  foreach ($i in $commandAst.CommandElements) {
    if ($i.Extent.StartOffset -ge $cursorPosition) {
      break
    }
    $prev = $i
  }
  $prev = $prev -is [System.Management.Automation.Language.StringConstantExpressionAst] ? $prev.Value : $prev.ToString()
  @(if ($wordToComplete.StartsWith('-')) {
      '--help', '-v', '--version', '-V', '-(', '--start-group', '-)', '--end-group', '-C', '--directory=', '-E', '--export-dynamic', '--no-export-dynamic', '-F', '--filter=', '-I', '--dynamic-linker=', '--no-dynamic-linker', '-L', '--library-path=', '-M', '--print-map', '-N', '--omagic', '--no-omagic', '-O', '-P', '--depaudit=', '-S', '--strip-debug', '-T', '--script=', '-X', '--discard-locals', '-e', '--entry=', '-f', '--auxiliary=', '-h', '--soname=', '-l', '--library=', '-m', '-o', '--output=', '-q', '--emit-relocs', '-r', '--relocatable', '-s', '--strip-all', '-u', '--undefined=', '-y', '--trace-symbol=', '--Bdynamic', '--dy', '--Bstatic', '--dn', '--static', '--Bsymbolic', '--Bsymbolic-functions', '--Bsymbolic-non-weak', '--Bsymbolic-non-weak-functions', '--Bno-symbolic', '--Map', '--Tbss=', '--Tdata=', '--Ttext=', '--allow-multiple-definition', '--apply-dynamic-relocs', '--no-apply-dynamic-relocs', '--as-needed', '--no-as-needed', '--audit=', '--build-id=none', '--build-id=md5', '--build-id=sha1', '--build-id=sha256', '--build-id=fast', '--build-id=uuid', '--no-build-id', '--chroot', '--color-diagnostics=auto', '--color-diagnostics=always', '--color-diagnostics=never', '--color-diagnostics', '--compress-debug-sections', '--dc', '--dependency-file=', '--defsym=SYMBOL=', '--demangle', '--no-demangle', '--detach', '--no-detach', '--enable-new-dtags', '--disable-new-dtags', '--execute-only', '--dp', '--dynamic-list=', '--dynamic-list-data', '--eh-frame-hdr', '--no-eh-frame-hdr', '--exclude-libs=', '--export-dynamic-symbol', '--export-dynamic-symbol-list=', '--fatal-warnings', '--no-fatal-warnings', '--fini=', '--fork', '--no-fork', '--gc-sections', '--no-gc-sections', '--gdb-index', '--hash-stylesysv', '--hash-stylegnu', '--hash-styleboth', '--hash-stylenone', '--icf=all', '--icf=safe', '--icf=none', '--no-icf', '--ignore-data-address-equality', '--image-base=', '--init=', '--nmagic', '--no-nmagic', '--no-undefined', '--noinhibit-exec', '--oformat=binary', '--pack-dyn-relocs=relr', '--pack-dyn-relocs=none', '--package-metadata=', '--perf', '--pie', '--pic-executable', '--no-pie', '--no-pic-executable', '--pop-state', '--print-gc-sections', '--no-print-gc-sections', '--print-icf-sections', '--no-print-icf-sections', '--push-state', '--quick-exit', '--no-quick-exit', '--relax', '--no-relax', '--repro', '--require-defined=', '--retain-symbols-file=', '--reverse-sections', '--rosegment', '--no-rosegment', '--rpath=', '--rpath-link=', '--run=', '--section-start=', '--separate-debug-file', '--separate-debug-file=', '--no-separate-debug-file', '--shared', '--Bshareable', '--shuffle-sections', '--shuffle-sections=', '--sort-common', '--sort-section', '--spare-dynamic-tags=', '--spare-program-headers=', '--start-lib', '--end-lib', '--stats', '--sysroot=', '--thread-count=', '--threads=', '--threads', '--no-threads', '--trace', '--undefined-glob=', '--undefined-version', '--no-undefined-version', '--unique=', '--unresolved-symbols=report-all', '--unresolved-symbols=ignore-all', '--unresolved-symbols=ignore-in-object-files', '--unresolved-symbols=ignore-in-shared-libs', '--version-script=', '--warn-common', '--no-warn-common', '--warn-once', '--warn-shared-textrel', '--warn-textrel', '--warn-unresolved-symbols', '--error-unresolved-symbols', '--whole-archive', '--no-whole-archive', '--wrap=', '-z'
    }
    elseif ($prev -ceq '-z') {
      'defs', 'nodefs', 'common-page-size=', 'execstack', 'noexecstack', 'execstack-if-needed', 'initfirst', 'interpose', 'keep-text-section-prefix', 'nokeep-text-section-prefix', 'lazy', 'max-page-size=', 'nocopyreloc', 'nodefaultlib', 'nodelete', 'nodlopen', 'nodump', 'now', 'origin', 'pack-relative-relocs', 'nopack-relative-relocs', 'sectionheader', 'nosectionheader', 'start_stop_visibility=hidden', 'start_stop_visibility=protected', 'separate-loadable-segments', 'separate-code', 'noseparate-code', 'stack-size=', 'relro', 'norelro', 'rewrite-endbr', 'norewrite-endbr', 'rodynamic', 'text', 'notext', 'textoff'
    }).Where{ $_ -like "$wordToComplete*" }
}
