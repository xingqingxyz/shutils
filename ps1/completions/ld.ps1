Register-ArgumentCompleter -Native -CommandName ld, ld.bfd -ScriptBlock {
  param ([string]$wordToComplete, [System.Management.Automation.Language.CommandAst]$commandAst, [int]$cursorPosition)
  $cursorPosition -= $wordToComplete.Length
  foreach ($i in $commandAst.CommandElements) {
    if ($i.Extent.StartOffset -ge $cursorPosition) {
      break
    }
    $prev = $i
  }
  $prev = $prev -is [System.Management.Automation.Language.StringConstantExpressionAst] ? $prev.Value : $prev.ToString()
  @(if ($wordToComplete.StartsWith('-')) {
      '--accept-unknown-input-arch', '--add-stdcall-alias', '--allow-multiple-definition', '--allow-shlib-undefined', '--architecture=', '--as-needed', '--audit=', '--auxiliary=', '--base_file', '--base_file=', '--build-id', '--build-id=', '--check-sections', '--compat-implib', '--compress-debug-sections=none', '--compress-debug-sections=zlib', '--compress-debug-sections=zlib-gabi', '--compress-debug-sections=zlib-gnu', '--compress-debug-sections=zstd', '--copy-dt-needed-entries', '--cref', '--ctf-share-types=share-duplicated', '--ctf-share-types=share-unconflicted', '--ctf-variables', '--default-imported-symver', '--default-script=', '--default-symver', '--defsym=', '--demangle', '--demangle=', '--depaudit=', '--dependency-file=', '--disable-auto-image-base', '--disable-auto-import', '--disable-dynamicbase', '--disable-forceinteg', '--disable-high-entropy-va', '--disable-large-address-aware', '--disable-linker-version', '--disable-long-section-names', '--disable-multiple-abs-defs', '--disable-new-dtags', '--disable-no-bind', '--disable-no-isolation', '--disable-no-seh', '--disable-nxcompat', '--disable-reloc-section', '--disable-runtime-pseudo-reloc', '--disable-stdcall-fixup', '--disable-tsaware', '--disable-wdmdriver', '--discard-all', '--discard-locals', '--discard-none', '--dll', '--dll-search-prefix=', '--dynamic-linker=', '--dynamic-list-cpp-new', '--dynamic-list-cpp-typeinfo', '--dynamic-list-data', '--dynamic-list=', '--dynamicbase', '--eh-frame-hdr', '--embedded-relocs', '--emit-relocs', '--enable-auto-image-base', '--enable-auto-image-base=', '--enable-auto-import', '--enable-extra-pe-debug', '--enable-extra-pep-debug', '--enable-linker-version', '--enable-long-section-names', '--enable-new-dtags', '--enable-non-contiguous-regions', '--enable-non-contiguous-regions-warnings', '--enable-reloc-section', '--enable-runtime-pseudo-reloc', '--enable-stdcall-fixup', '--end-group', '--entry=', '--error-execstack', '--error-handling-script', '--error-rwx-segments', '--error-unresolved-symbols', '--exclude-all-symbols', '--exclude-libs=', '--exclude-libs=LIBS', '--exclude-modules-for-implib=', '--exclude-symbols=', '--export-all-symbols', '--export-dynamic', '--export-dynamic-symbol-list=', '--export-dynamic-symbol=', '--fatal-warnings', '--file-alignment', '--file-alignment=', '--filter=', '--force-exe-suffix', '--force-group-allocation', '--forceinteg', '--format=binary', '--format=elf32-big', '--format=elf32-i386', '--format=elf32-iamcu', '--format=elf32-little', '--format=elf32-x86-64', '--format=elf64-big', '--format=elf64-bpfbe', '--format=elf64-bpfle', '--format=elf64-little', '--format=elf64-x86-64', '--format=ihex', '--format=pdb', '--format=pe-bigobj-x86-64', '--format=pe-i386', '--format=pe-x86-64', '--format=pei-i386', '--format=pei-x86-64', '--format=plugin', '--format=srec', '--format=symbolsrec', '--format=tekhex', '--format=verilog', '--gc-keep-exported', '--gc-sections', '--gnu-tls-tag', '--gnu2-tls-tag', '--gpsize=', '--hash-size=', '--hash-style=', '--heap', '--heap=', '--help', '--high-entropy-va', '--ignore-unresolved-symbol=', '--image-base', '--image-base=', '--insert-timestamp', '--just-symbols=', '--kill-at', '--large-address-aware', '--ld-generated-unwind-info', '--leading-underscore', '--library-path=', '--library=', '--major-image-version', '--major-image-version=', '--major-os-version', '--major-os-version=', '--major-subsystem-version', '--major-subsystem-version=', '--map-whole-files', '--max-cache-size=', '--minor-image-version', '--minor-image-version=', '--minor-os-version', '--minor-os-version=', '--minor-subsystem-version', '--minor-subsystem-version=', '--mri-script=', '--nmagic', '--no-accept-unknown-input-arch', '--no-allow-shlib-undefined', '--no-as-needed', '--no-bind', '--no-check-sections', '--no-copy-dt-needed-entries', '--no-ctf-variables', '--no-define-common', '--no-demangle', '--no-dynamic-linker', '--no-eh-frame-hdr', '--no-error-execstack', '--no-error-rwx-segments', '--no-export-dynamic', '--no-fatal-warnings', '--no-gc-sections', '--no-gnu-tls-tag', '--no-gnu2-tls-tag', '--no-insert-timestamp', '--no-isolation', '--no-keep-memory', '--no-ld-generated-unwind-info', '--no-leading-underscore', '--no-map-whole-files', '--no-omagic', '--no-print-gc-sections', '--no-print-map-discarded', '--no-print-map-locals', '--no-relax', '--no-rosegment', '--no-seh', '--no-stats', '--no-strip-discarded', '--no-undefined', '--no-undefined-version', '--no-warn-execstack', '--no-warn-mismatch', '--no-warn-rwx-segments', '--no-warn-search-mismatch', '--no-warnings', '--no-whole-archive', '--noinhibit-exec', '--nxcompat', '--oformat=', '--omagic', '--orphan-handling', '--orphan-handling=', '--out-implib=', '--output-def=', '--output=', '--package-metadata', '--package-metadata=', '--pic-executable', '--pop-state', '--print-gc-sections', '--print-map', '--print-map-discarded', '--print-map-locals', '--print-memory-usage', '--print-output-format', '--print-sysroot', '--push-state', '--reduce-memory-overheads', '--relax', '--relocatable', '--remap-inputs-file=', '--remap-inputs=', '--require-defined', '--retain-symbols-file=', '--rosegment', '--script=', '--section-alignment', '--section-alignment=', '--section-ordering-file=', '--section-start=', '--sort-common', '--sort-common=ascending', '--sort-common=descending', '--sort-section=', '--spare-dynamic-tags=', '--split-by-file', '--split-by-file=', '--split-by-reloc', '--split-by-reloc=', '--stack', '--stack=', '--start-group', '--stats', '--strip-all', '--strip-debug', '--strip-discarded', '--subsystem', '--subsystem=', '--support-old-code', '--sysroot=', '--target-help', '--task-link=', '--thumb-entry=', '--trace', '--trace-symbol', '--traditional-format', '--tsaware', '--undefined-version', '--undefined=', '--unique', '--unique=', '--unresolved-symbols=ignore-all', '--unresolved-symbols=ignore-in-object-files', '--unresolved-symbols=ignore-in-shared-libs', '--unresolved-symbols=report-all', '--verbose', '--verbose=', '--version', '--version-exports-section=', '--version-script=', '--warn-alternate-em', '--warn-common', '--warn-constructors', '--warn-duplicate-exports', '--warn-execstack', '--warn-execstack-objects', '--warn-multiple-gp', '--warn-once', '--warn-rwx-segments', '--warn-section-align', '--warn-textrel', '--warn-unresolved-symbols', '--wdmdriver', '--whole-archive', '--wrap=', '-(', '-)', '-a', '-assert', '-b', '-Bdynamic', '-Bgroup', '-Bno-symbolic', '-Bshareable', '-Bstatic', '-Bsymbolic', '-Bsymbolic-functions', '-c', '-call_shared', '-d', '-dc', '-dn', '-dp', '-dT', '-dy', '-e', '-EB', '-EL', '-F', '-fini=', '-flto', '-flto-partition=', '-fuse-ld=', '-G', '-h', '-i', '-init=', '-L', '-M', '-Map', '-N', '-no-pie', '-non_shared', '-nostdlib', '-o', '-P', '-pie', '-plugin-opt=', '-plugin-save-temps', '-plugin=', '-q', '-qmagic', '-Qy', '-r', '-rpath-link=', '-rpath=', '-s', '-shared', '-soname=', '-static', '-t', '-Tbss=', '-Tdata=', '-Tldata-segment=', '-Trodata-segment=', '-Ttext-segment=', '-Ttext=', '-u', '-Ur', '-v', '-w', '-X', '-Y', '-z'
    }
    elseif ($prev -ceq '-m') {
      'elf_x86_64', 'elf32_x86_64', 'elf_i386', 'elf_iamcu', 'i386pep', 'i386pe', 'elf64bpf'
    }
    elseif ($prev -ceq '-z') {
      'call-nop=', 'cet-report=error', 'cet-report=none', 'cet-report=warning', 'combreloc', 'common', 'common-page-size=', 'defs', 'dynamic-undefined-weak', 'execstack', 'global', 'globalaudit', 'ibt', 'ibtplt', 'indirect-extern-access', 'initfirst', 'interpose', 'isa-level-report=all', 'isa-level-report=needed', 'isa-level-report=none', 'isa-level-report=used', 'lam-report=error', 'lam-report=none', 'lam-report=warning', 'lam-u48', 'lam-u48-report=error', 'lam-u48-report=none', 'lam-u48-report=warning', 'lam-u57', 'lam-u57-report=error', 'lam-u57-report=none', 'lam-u57-report=warning', 'lazy', 'loadfltr', 'mark-plt', 'max-page-size=', 'memory-seal', 'muldefs', 'nocombreloc', 'nocommon', 'nocopyreloc', 'nodefaultlib', 'nodelete', 'nodlopen', 'nodump', 'nodynamic-undefined-weak', 'noexecstack', 'noextern-protected-data', 'noindirect-extern-access', 'nomark-plt', 'nomemory-seal', 'nopack-relative-relocs', 'noreloc-overflow', 'norelro', 'nosectionheader', 'noseparate-code', 'nostart-stop-gc', 'notext', 'nounique', 'nounique-symbol', 'now', 'origin', 'pack-relative-relocs', 'relro', 'report-relative-reloc', 'sectionheader', 'separate-code', 'shstk', 'stack-size=', 'start-stop-gc', 'start-stop-visibility=DEFAULT', 'start-stop-visibility=HIDDEN', 'start-stop-visibility=INTERNAL', 'start-stop-visibility=PROTECTED', 'text', 'textoff', 'undefs', 'unique', 'unique-symbol', 'x86-64-baseline', 'x86-64-v2', 'x86-64-v3', 'x86-64-v4'
    }).Where{ $_ -like "$wordToComplete*" }
}
