#!/usr/bin/env bash

case "$1" in
  -h | --help)
    echo "Usage: $0 upgrade ...<package>"
    ;;
  -v | --version)
    echo 'pkg 0.0.0'
    ;;
  upgrade)
    if [ -z "$2" ]; then
      echo 'no package specicfied to upgrade' >&2
      exit 1
    fi
    dir=$(realpath "${BASH_SOURCE[0]}")
    dir=${dir%/*}/../pkgs
    while [ -n "$2" ]; do
      (
        set -e
        # shellcheck disable=SC1090
        . "$dir/$2.sh"
      ) &
      shift
    done
    ;;
  *)
    echo "unknown command: $1" >&2
    exit 1
    ;;
esac
